<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Using Delegates</title>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">
      <h1>Using Delegates</h1>
      <p>It is easy to create a <a href="script.html">script</a> attribute to run at a particular point in the game, but what if you want to create a script attribute that returns a value, or accepts particular parameters? It would look a lot like a function. The answer is to use <strong>delegates</strong>.</p>

<p>First you need to define the delegate, using a <a href="../elements/delegate_element.html">delegate</a> XML tag. This accepts the same attributes as the <a href="../elements/function_element.html">function</a> tag, so you can specify parameters and/or a return value type.</p>

<p>Now you can simply use the delegate name as an attribute type name.</p>

<ul>
<li>  To run a delegate which does not return a value, use the <a href="../scripts/rundelegate.html">rundelegate</a> script command.</li>
<li>  To get a return value from a delegate, use the <a href="../functions/rundelegatefunction.html">RunDelegateFunction</a> function.</li>
<li>  To see if an object implements a delegate, use the <a href="../functions/hasdelegateimplementation.html">HasDelegateImplementation</a> function.</li>
</ul>

<h2>Delegates in Action</h2>

<p>Let us see this in action. First, a bit of terminology. In &quot;object-orientated programming&quot; a function that is attached to an object is called a &quot;method&quot;, and I am going to adopt that term here. The &quot;signature&quot; of a method is the return type and the parameters it expects (a Quest function similarly has a signature).</p>

<p>Here is a very simple game where you can hit a goblin.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;!--Saved by Quest 5.4.4873.16527--&gt;
  &lt;asl version=&quot;540&quot;&gt;
    &lt;include ref=&quot;English.aslx&quot; /&gt;
    &lt;include ref=&quot;Core.aslx&quot; /&gt;
    &lt;game name=&quot;test&quot;&gt;
      &lt;gameid&gt;cb4455e4-6e7c-45da-bf39-f2126e817fb1&lt;/gameid&gt;
      &lt;version&gt;1.1&lt;/version&gt;
      &lt;firstpublished&gt;2013&lt;/firstpublished&gt;
    &lt;/game&gt;
    &lt;object name=&quot;room&quot;&gt;
      &lt;inherit name=&quot;editor_room&quot; /&gt;
      &lt;object name=&quot;player&quot;&gt;
        &lt;inherit name=&quot;editor_object&quot; /&gt;
        &lt;inherit name=&quot;editor_player&quot; /&gt;
      &lt;/object&gt;
      &lt;object name=&quot;goblin&quot;&gt;
        &lt;inherit name=&quot;editor_object&quot; /&gt;
        &lt;fullhits type=&quot;int&quot;&gt;10&lt;/fullhits&gt;
        &lt;hitslost type=&quot;int&quot;&gt;0&lt;/hitslost&gt;
        &lt;hit type=&quot;script&quot;&gt;
          msg (&quot;You hit the &quot; + this.name + &quot; and it loses 7 hits!&quot;)
          this.hitslost = this.hitslost + 7
        &lt;/hit&gt;
      &lt;/object&gt;
    &lt;/object&gt;
  &lt;/asl&gt;
</code></pre></div>
<p>The goblin object has a method, called &quot;hit&quot;. It is also a script, as it takes no parameters and returns no value.</p>

<p>We will now set up a new method, which will return the percentage of the goblin&#39;s full hits that it has remaining. A delegate is essentially a way to define a custom signature, in this case it will look like this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;delegate name=&quot;script_returns_int&quot; type=&quot;int&quot; /&gt;
</code></pre></div>
<p>This has to appear in your code before the delegate is used - just after the library includes seems best to me. Here is the modified game:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;!--Saved by Quest 5.4.4873.16527--&gt;
  &lt;asl version=&quot;540&quot;&gt;
    &lt;include ref=&quot;English.aslx&quot; /&gt;
    &lt;include ref=&quot;Core.aslx&quot; /&gt;
    &lt;delegate name=&quot;script_returns_int&quot; type=&quot;int&quot; /&gt;
    &lt;game name=&quot;test&quot;&gt;
      &lt;gameid&gt;cb4455e4-6e7c-45da-bf39-f2126e817fb1&lt;/gameid&gt;
      &lt;version&gt;1.1&lt;/version&gt;
      &lt;firstpublished&gt;2013&lt;/firstpublished&gt;
    &lt;/game&gt;
    &lt;object name=&quot;room&quot;&gt;
      &lt;inherit name=&quot;editor_room&quot; /&gt;
      &lt;object name=&quot;player&quot;&gt;
        &lt;inherit name=&quot;editor_object&quot; /&gt;
        &lt;inherit name=&quot;editor_player&quot; /&gt;
      &lt;/object&gt;
      &lt;object name=&quot;goblin&quot;&gt;
        &lt;inherit name=&quot;editor_object&quot; /&gt;
        &lt;fullhits type=&quot;int&quot;&gt;10&lt;/fullhits&gt;
        &lt;hitslost type=&quot;int&quot;&gt;0&lt;/hitslost&gt;
        &lt;getpc type=&quot;script_returns_int&quot;&gt;
          return (100 * (this.fullhits - this.hitslost) / this.fullhits)
        &lt;/getpc&gt;
        &lt;hit type=&quot;script&quot;&gt;
          msg (&quot;You hit the &quot; + this.name + &quot; and it loses 7 hits!&quot;)
          this.hitslost = this.hitslost + 7
          msg (&quot;The &quot; + this.name + &quot; has &quot; + RunDelegateFunction (this, &quot;getpc&quot;) + &quot;% of its hits.&quot;)
        &lt;/hit&gt;
      &lt;/object&gt;
    &lt;/object&gt;
  &lt;/asl&gt;
</code></pre></div>
<p>Note the new method, &quot;getpc&quot;. It is set up like a script, but its type is what was defined by the delegate, rather than &quot;script&quot;. Also, to invoke it, use &quot;RunDelegateFunction&quot; rather than &quot;do&quot;.</p>

<p>Suppose we want to kick that goblin too. We do not want to have to repeat code, so the kick and hit scripts are going to call a new method, &quot;attack&quot;, and send a parameter, the damage done. We need a new delegate, this time allowing a parameter to be sent, rather than a value to be returned (you can readily do both, of course, if you need to).</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;delegate name=&quot;script_with_1&quot; parameters=&quot;a&quot; /&gt;
</code></pre></div>
<p>The game now looks like this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;!--Saved by Quest 5.4.4873.16527--&gt;
  &lt;asl version=&quot;540&quot;&gt;
    &lt;include ref=&quot;English.aslx&quot; /&gt;
    &lt;include ref=&quot;Core.aslx&quot; /&gt;
    &lt;delegate name=&quot;script_returns_int&quot; parameters=&quot;&quot; type=&quot;int&quot; /&gt;
    &lt;delegate name=&quot;script_with_1&quot; parameters=&quot;a&quot; /&gt;
    &lt;game name=&quot;test&quot;&gt;
      &lt;gameid&gt;cb4455e4-6e7c-45da-bf39-f2126e817fb1&lt;/gameid&gt;
      &lt;version&gt;1.1&lt;/version&gt;
      &lt;firstpublished&gt;2013&lt;/firstpublished&gt;
    &lt;/game&gt;
    &lt;object name=&quot;room&quot;&gt;
      &lt;inherit name=&quot;editor_room&quot; /&gt;
      &lt;object name=&quot;player&quot;&gt;
        &lt;inherit name=&quot;editor_object&quot; /&gt;
        &lt;inherit name=&quot;editor_player&quot; /&gt;
      &lt;/object&gt;
      &lt;object name=&quot;goblin&quot;&gt;
        &lt;inherit name=&quot;editor_object&quot; /&gt;
        &lt;fullhits type=&quot;int&quot;&gt;25&lt;/fullhits&gt;
        &lt;hitslost type=&quot;int&quot;&gt;0&lt;/hitslost&gt;
        &lt;getpc type=&quot;script_returns_int&quot;&gt;
          return (100 * (this.fullhits - this.hitslost) / this.fullhits)
        &lt;/getpc&gt;
        &lt;attack type=&quot;script_with_1&quot;&gt;
          msg (&quot;You hit the &quot; + this.name + &quot; and it loses &quot; + a + &quot; hits!&quot;)
          this.hitslost = this.hitslost + a
          msg (&quot;The &quot; + this.name + &quot; has &quot; + RunDelegateFunction (this, &quot;getpc&quot;) + &quot;% of its hits.&quot;)
        &lt;/attack&gt;
        &lt;gethits type=&quot;script_returns_int&quot;&gt;
          return (this.fullhits - this.hitslost)
        &lt;/gethits&gt;
        &lt;hit type=&quot;script&quot;&gt;
          rundelegate (this, &quot;attack&quot;, 4)
        &lt;/hit&gt;
        &lt;kick type=&quot;script&quot;&gt;
          rundelegate (this, &quot;attack&quot;, 7)
        &lt;/kick&gt;
      &lt;/object&gt;
    &lt;/object&gt;
    &lt;verb&gt;
      &lt;property&gt;kick&lt;/property&gt;
      &lt;pattern&gt;kick&lt;/pattern&gt;
      &lt;defaultexpression&gt;&quot;You can&#39;t kick &quot; + object.article + &quot;.&quot;&lt;/defaultexpression&gt;
    &lt;/verb&gt;
  &lt;/asl&gt;
</code></pre></div>
<p>Note that we use &quot;rundelegate&quot; to invoke the new method, as it does not return a value.</p>

<p>Also note that the parameters for your method must have the same names as those in your delegate definition.</p>

    </div>
  </body>
</html>
