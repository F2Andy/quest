<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Immobilise the player</title>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">
      <h1>Immobilise the player</h1>
      <p>Occasionally you want to stop the player moving to another room, say because he is sat down, and he has to stand first, or he is tied up or whatever.</p>

<h2>Move to another room</h2>

<p>One way to do this is to move him to another room with no exits, and that might be appropriate in some case. Suppose the player logs on to a computer, and while logged on, all commmands relate to the computer. The player does not need to interact or even see other objects in the room with the computer, so effectively moving the player inside the computer is a good solution.</p>

<h2>Block the exit</h2>

<p>If this is something that happens in one room with a small number of exits, then it is easy to just lock the exits while the player is immobilised, unlock them afterwards.</p>

<h2>Rewrite the go command</h2>

<p>This is a little more complicated, but more general. What you do is set a flag on the player, when it is true, the player cannot move, when it is false or absent, he can.</p>

<p>The way to do this is to rewrite the go command.</p>

<p>Here is the modified command, just paste it into your code - but make sure it is inside the asl tags and no other tags. If in doubt, in the GUI, at the bottom left, select &quot;Filter - Show Library Elements&quot;, then find &quot;Go&quot; from the list of commands (it will be abpout a third of the way down the greyed out commands). Click the &quot;Copy&quot; button in the top right, then go into code mode. You will find a section of code like that below, but with the name &quot;go&quot; and missing lines five to seven. Replace that with the code below.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;command name=&quot;go_subverted&quot;&gt;
    &lt;pattern type=&quot;string&quot;&gt;&lt;![CDATA[^go to (?&lt;exit&gt;.*)$|^go (?&lt;exit&gt;.*)$|^(?&lt;exit&gt;north|east|south|west|northeast|northwest|southeast|southwest|in|out|up|down|n|e|s|w|ne|nw|se|sw|o|u|d)$]]&gt;&lt;/pattern&gt;
    &lt;unresolved&gt;You can&#39;t go there.&lt;/unresolved&gt;
    &lt;script&gt;
      if (GetBoolean (player, &quot;immobilised&quot;)) {
        Print (player.immobilisedmessage)
      }
      else if (exit.locked) {
        msg (exit.lockmessage)
      }
      else if (HasScript(exit, &quot;script&quot;)) {
        do (exit, &quot;script&quot;)
      }
      else {
        if (exit.lookonly) {
          msg (&quot;You can&#39;t go there.&quot;)
        }
        else {
          player.parent = exit.to
        }
      }
    &lt;/script&gt;
  &lt;/command&gt;
</code></pre></div>
<p>Quest does not like commands to have the same name as existing commands, so it needs a new name, but the same matching pattern.</p>

<p>Besides that, the only difference is that before doing anything else, the script checks for the immobilised flag on the player. If it is true, it prints a message, the value of the attribute player.immobilisedmessage. If false (or not there) it proceeds as normal.</p>

<p>Now to immobilise the player, your code needs to do something like this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  player.immobilised = True
  player.immobilisedmessage = &quot;Cannot move while seated.&quot;
</code></pre></div>
<p>To allow him to move again:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  player.immobilised = False
</code></pre></div>
    </div>
  </body>
</html>
