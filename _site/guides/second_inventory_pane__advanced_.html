<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Second Inventory Pane (Advanced)</title>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">
      <h1>Second Inventory Pane (Advanced)</h1>
      <p>Sometimes it is useful to have a second inventory panel, and a good example of that is to hold spells available to the player. To illustrate how to implement this, I am going to add this functionality to the combat game developed in previous pages.</p>

<h2>Step 1 - Downloads</h2>

<p>You need a library file and a JavaScript file written by jay Nabonne, and a library file by the Pixie. You can get them here:</p>

<p><a href="http://quest5.net/downloads/InvPane2.aslx">InvPane2.aslx</a> | <a href="http://quest5.net/downloads/InvPane2.js">InvPane2.js</a> | <a href="http://quest5.net/downloads/ScopeLib.aslx">ScopeLib.aslx</a></p>

<h2>Step 1 - Infrastructure</h2>

<p>You now need to add the libraries to your game. In the right hand pane, click on Advanced &quot;+&quot; to open that up, then select &quot;Included Libraries&quot;. Click &quot;Add&quot;, and the &quot;Browse&quot;, and navigate to the downloaded file <em>InvPane2.aslx</em>. Click add again, and navigate to the downloaded file <em>ScopeLib.aslx</em>. You then need to save your game, and click on the reload button at the top right.</p>

<p>Click on Advanced &quot;+&quot; again to open that up, then select &quot;JavaScript&quot;. As before, click &quot;Add&quot;, and the &quot;Browse&quot;, and navigate to the downloaded file <em>InvPane2.js</em>. You will suddenly see a lot of code in the window, but you do not have to do anything with it!</p>

<p>Create a new room, let us say it is called <em>spells_known</em>.</p>

<h2>Step 2 - Start-up Script</h2>

<p>Create a new start up script on the Script tab of the Game object (if you already have a start-up script, just add these lines to it).</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  SetInventory2Label (&quot;Spells&quot;)
  SetInventory2 (GetDirectChildren (spells_known))
</code></pre></div>
<p>This first line gives your new inventory a title, the second populates the inventory with anything in the <em>spells_known</em> room.</p>

<h2>Step 3 - Putting things in the inventory at the start</h2>

<p>Anything you want the player to start the game with should go into the <em>spells_known</em> room. Simple. You may want to change the inventory verbs; for spells this would mean having <em>Cast</em>, but not <em>Learn</em>.</p>

<h2>Step 4 - Putting things in the inventory during play</h2>

<p>How you do this depends on how you are using it. The important steps are to move the object to the room, <em>spells_known</em>, and to update the inventory when you have done so. In this example, the learn script will then look like this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    &lt;learn type=&quot;script&quot;&gt;&lt;![CDATA[
      if (not this.parent = game.pov) {
        this.parent = spells_known
        this.inventoryverbs = Split (&quot;Cast&quot;, &quot; &quot;)
        msg (DynamicTemplate(&quot;SpellLearnt&quot;, this))
        SetInventory2 (GetDirectChildren (spells_known))        
      }
      else {
        msg (&quot;[SpellAlreadyKnown]&quot;)
      }
    ]]&gt;&lt;/learn&gt;
</code></pre></div>
<h2>Step 5 - Taking things out of the inventory</h2>

<p>This is just the reverse of step 4. the object has to be moved away, and then you call:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  SetInventory2 (GetDirectChildren (spells_known)).
</code></pre></div>
<h2>Step 6 - Using things in the inventory</h2>

<p>If the player tries to use something from the inventory at this point, he will be told it is not here - as far as Quest in concerned it is in another room!</p>

<p>To get around that, we will use <em>ScopeLib</em>. This will require that cast is handled as a command, rather than a verb, so the verb can be removed entirely. The command will look like this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;command name=&quot;cast_spell&quot;&gt;
    &lt;pattern&gt;cast #text#;invoke #text#&lt;/pattern&gt;
    &lt;script&gt;
      ProcessScopeCommand (&quot;cast&quot;, spells_known, text, &quot;You don&#39;t know a spell like that&quot;, &quot;I&#39;m not sure that is really a spell&quot;)
    &lt;/script&gt;
  &lt;/command&gt;
</code></pre></div>
<p>All the difficult stuff happens in <em>ProcessScopeCommand</em>. All we need to know is the parameters. The first is the name of the script that will be called. That is already there, and is called &quot;cast&quot;. The second parameter is a list of objects, in this case the spells in the <em>spells_known</em> room. The third is the variable Quest is using to hold the text, and is called <em>text</em>. The last two are error responses - what the player will see in case the spell is not found or does not have the right script.</p>

<h2>Step 7 - Tidying up</h2>

<p>Finally we need to modify the cast scripts, as they check the player is holding the spell. The <em>ProcessScopeCommand</em> has already checked the spell is in the right place, so it is just a case of deleting five lines. From this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    &lt;cast type=&quot;script&quot;&gt;&lt;![CDATA[
      if (this.parent = game.pov) {
        DescribeCast (this)
        flag = False
        foreach (obj, ScopeVisibleNotHeld ()) {
          if (DoesInherit (obj, &quot;monster&quot;) and not GetBoolean (obj, &quot;dead&quot;)) {
            SpellAttackMonster (obj, this)
            flag = True
          }
        }
        if (not flag) {
          msg (&quot;... [NoMonstersPresent]&quot;)
        }
        CancelSpell ()
      }
      else {
        msg (&quot;[SpellNotKnown]&quot;)
      }
    ]]&gt;&lt;/cast&gt;
</code></pre></div>
<p>To this;</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    &lt;cast type=&quot;script&quot;&gt;&lt;![CDATA[
        DescribeCast (this)
        flag = False
        foreach (obj, ScopeVisibleNotHeld ()) {
          if (DoesInherit (obj, &quot;monster&quot;) and not GetBoolean (obj, &quot;dead&quot;)) {
            SpellAttackMonster (obj, this)
            flag = True
          }
        }
        if (not flag) {
          msg (&quot;... [NoMonstersPresent]&quot;)
        }
        CancelSpell ()
    ]]&gt;&lt;/cast&gt;
</code></pre></div>
<p>Similar for other cast scripts.</p>

<h2>Everything Done</h2>

<p>The new combat library and demo can be downloaded here (but remember you still need the three files mentioned at the start as well):</p>

<p><a href="http://quest5.net/downloads/CombatLibrary2.aslx">CombatLibrary2.aslx</a> | <a href="http://quest5.net/downloads/CombatDemo2.aslx">CombatDemo2.aslx</a></p>

    </div>
  </body>
</html>
