<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Turn-based events</title>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">
      <h1>Turn-based events</h1>
      <p>If your game is only responding to what the player does, it feels dead. Bring it alive by having events occur that are not simply reacting to the player&#39;s actions (even if they are reacting to what he did four turns ago, it will still feel like it is not).</p>

<p>Here then is a simple framework for turn-based events.</p>

<h2>Set up the framework</h2>

<p>To use it:</p>

<ol>
<li><p>Set an int attribute on game called &quot;turn&quot;.</p></li>
<li><p>Create two dummy rooms, &quot;active_events&quot; and &quot;dead_events&quot;. They should have no exits and should not be accessed by the player.</p></li>
<li><p>Copy this turnscript and type into your game code. Insert it at the end, just before the last line (which will be &quot;</asl>&quot;)</p>

<p><turnscript name="eventhandler">
    <enabled />
    <script>&lt;![CDATA[
      game.turn = game.turn + 1
      foreach (evt, GetDirectChildren (active<em>events)) {
        if (evt.turn &lt;= game.turn) {
          do (evt, &quot;action&quot;)
          if (evt.auto) {
            evt.parent = dead</em>events
            if (HasAttribute (evt, &quot;next&quot;)) {
              evt.next.turn = evt.nextturn + game.turn
              evt.next.parent = active_events
            }
          }
        }
      }
    ]]&gt;</script>
  </turnscript></p>

<p><type name="event_type">
    <done type="boolean">false</done>
    <auto />
    <turn type="int">-1</turn>
    <action type="script">
      msg (&quot;TODO&quot;)
    </action>
  </type></p></li>
</ol>

<h2>Set up events</h2>

<p>Each event needs to be an object in one of the rooms, &quot;active_events&quot; and &quot;dead_events&quot;. The room &quot;active_events&quot; is for events that are counting down, while &quot;dead_events&quot; is for events that have expired or are waiting in the wings to be used.</p>

<p>For each event, set it to inherit &quot;event_type&quot;. You also need to set the &quot;action&quot; attribute; this is the script that will get run.</p>

<p>For events in &quot;active_events&quot;, you need to set the &quot;turn&quot; attribute. The event will be fired in that number of turns, and will then get moved to the &quot;dead_events&quot; room.</p>

<p>For events in &quot;dead_events&quot;, you need to set up something to start them off. This needs to move the event into the &quot;active_events&quot;, and to set the &quot;turn&quot; attribute to game.turn plus the number of turns to wait. It might look something like this, when the event, event3, is set to occur in 2 turns:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  event3.turn = 2 + game.turn
  event3.parent = active_events
</code></pre></div>
<h2>Chaining events</h2>

<p>You can set up one event to start the count down to another very easily. Just set the &quot;next&quot; attribute to the event to be started, and the &quot;nextturn&quot; attribute to the number of turns to wait.</p>

<h2>Turn off auto</h2>

<p>By default, events are automatically moved to &quot;dead_events&quot; and start the next chained event (if set) when they trigger. Setting the &quot;auto&quot; attribute to false stops that behaviour. This may be desirable if you want to wait until the player is in a certain room, for example.</p>

<h2>Example game</h2>

<p>Right-click the link and select save or something like that.</p>

<p><a href="http://quest5.net/downloads/Events.aslx">Events.aslx</a></p>

<p>There are only two rooms and three events. Event 1 initiates the countdown to event 2, which in turn sets off event 3. Event 2 has &quot;auto&quot; set to false, so it keeps going until a condition is met (player in room 2), and only then starts the countdown to event 3.</p>

<h2>Note</h2>

<p>Quest counts each player input as a turn. If the player spending 10 turns typing commands that are not recognised, that is still 10 turns. Conversely, if the player types five commands in one line (eg &quot;n.get spade.s.s.drop spade&quot;) then that is only one turn.</p>

    </div>
  </body>
</html>
