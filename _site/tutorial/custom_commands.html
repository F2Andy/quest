<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Custom commands</title>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">
      <h1>Custom commands</h1>
      <p>In this section, we will add a <strong>command</strong> that lets the player &quot;weigh&quot; an object.</p>

<p>Note that we will <em>not</em> be using a <strong>verb</strong> here, as we have done before. Why not? Verbs are good when you want to have a <em>separate</em> response for each object, what we want is <em>one</em> script that will return information about <em>any object</em>. For this, we need to use a <strong>command</strong>.</p>

<h2>Adding a Simple Command</h2>

<p>Let&#39;s add a simple command - &quot;say&quot;. This will let the player type conversation prefixed with the command &quot;say,&quot; for example &quot;say hello&quot;. Quest will respond with &quot;You say &#39;hello.&#39; We will also add the contextual text of &quot;but nobody replies&quot; as no-one is present in the game at this point.</p>

<p>To add a command:</p>

<ul>
<li>  In the Windows desktop version, select &quot;game&quot; in the tree. Now, you can right-click on the tree and choose &quot;Add Command&quot;, or use the Add menu and choose &quot;Command&quot;.</li>
<li>  In the web version, select &quot;Commands&quot; in the tree (underneath &quot;game&quot;). Then click the &quot;Add&quot; button.</li>
</ul>

<p>Enter the following text into the command pattern box:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> say #text#
</code></pre></div>
<p>This pattern handles the player typing the command &quot;say&quot; followed by any text. The text following the &quot;say&quot; command is then put into a string variable called &quot;text&quot;.</p>

<p>For example:</p>

<ul>
<li>  If the player types &quot;say hello&quot;, the &quot;text&quot; string variable will contain &quot;hello&quot;</li>
<li>  If the player types &quot;say what a lovely day&quot;, the &quot;text&quot; string variable will contain &quot;what a lovely day&quot;</li>
</ul>

<p>We can read string variables within an expression, in exactly the same way as we read object attributes in the previous section.</p>

<p>Whenever the player types in a command that matches the command template, the associated script will be run. Let&#39;s now add a script to print the required response. Add a &quot;print a message&quot; command and choose &quot;expression&quot;. Then enter this expression:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> &quot;You say \&quot;&quot; + text + &quot;\&quot;, but nobody replies.&quot;
</code></pre></div>
<p>What&#39;s with the backslashes in there? They let us use quotation marks inside an expression - if you put a backslash before a quote character, that quote character won&#39;t be interpreted as the end of a string.</p>

<p>But if you don&#39;t want like the backslashes, you could use single quotes quite safely instead:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> &quot;You say &#39;&quot; + text + &quot;&#39;, but nobody replies.&quot;
</code></pre></div>
<p><img src="Commandsay.png" alt="" title="Commandsay.png"></p>

<p>Launch the game and type in a few &quot;say&quot; commands to see that Quest responds correctly.</p>

<h2>Alternative Command Patterns</h2>

<p>You can easily add alternatives to a command pattern by separating them with semicolons. For example, we could adapt our &quot;say #text#&quot; command to deal with &quot;shout&quot; and &quot;yell&quot; by modifying the pattern to read:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> say #text#; shout #text#; yell #text#
</code></pre></div>
<h2>Adding a &quot;Weigh&quot; Command</h2>

<p>We now know how to add a command that will process any kind of text the player enters. However, a lot of the time, our commands will be dealing with objects that the player can see. To handle objects correctly, just use the variable name &quot;object&quot;. So the &quot;weigh&quot; command&#39;s pattern should be:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> weigh #object#
</code></pre></div>
<p>If you want to create a command that uses multiple objects, you can call your variables &quot;object1&quot;, &quot;object2&quot; etc. - in fact anything starting with &quot;object&quot; will work.</p>

<p>The script we enter for the &quot;weigh&quot; command should respond &quot;It weighs X grams&quot;, where X is the weight of the item â€“ as reported by its &quot;weight&quot; attribute.</p>

<p>We can read the weight attribute in the same way as before:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> object.weight
</code></pre></div>
<p>Previously, we put an actual object name before the dot. This time, we&#39;re putting a variable name there - so we&#39;ll read the &quot;weight&quot; attribute of the object that the player entered.</p>

<p>Add the weight command using the command pattern above, and add a &quot;print a message&quot; command to print this expression:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> &quot;It weighs &quot; + object.weight + &quot; grams.&quot;
</code></pre></div>
<p><img src="Commandweigh.png" alt="" title="Commandweigh.png"></p>

<p>Launch the game and go to the kitchen. See what happens when you type &quot;weigh flour&quot;, &quot;weigh sugar&quot; etc.</p>

<p>Now go back to the lounge. What happens when you weigh Bob?</p>

<p>Quest responds with &quot;It weighs grams.&quot; Why? Because he doesn&#39;t have a &quot;weight&quot; attribute. Since we don&#39;t want to have to enter a weight for every single object in the game, we&#39;ll need to update our command so it checks for the existence of the &quot;weight&quot; attribute, and then prints the appropriate response.</p>

<h2>Checking for an Attribute</h2>

<p>Go back to the script for the &quot;weigh&quot; command, select the existing &quot;Print a message&quot; command and click the &quot;Cut&quot; button on the Script Editor to move this to the clipboard.</p>

<p>Now, add a new &quot;if&quot; command. From the dropdown, select &quot;object has attribute&quot;. Enter the object expression &quot;object&quot;. For the attribute, leave &quot;name&quot; selected and type in &quot;weight&quot;.</p>

<p>Expand the &quot;Then&quot; script, and click Paste to restore the previous &quot;print a message&quot; script. For the &quot;Else&quot; script, print a message like &quot;You can&#39;t weigh that&quot;.</p>

<p>The script should now look like this:</p>

<p><img src="Checkforattribute.png" alt="" title="Checkforattribute.png"></p>

<p>Launch the game and verify that you now get a sensible response for &quot;weigh bob&quot; and &quot;weigh sofa&quot; in the lounge (it should say &quot;You can&#39;t weigh that&quot;) and that you can still weigh the items in the kitchen.</p>

<h2>Additional example</h2>

<p>Quest can handle text and objects in the same command. Here the say command is extended to allow the plaer to specify who she is talking to.</p>

<p><img src="Say%20to%20troll.png" alt="" title="Say to troll.png"></p>

<p>In code, it looks like this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  &lt;command name=&quot;saying&quot;&gt;
    &lt;pattern&gt;say #text_talk# to #object_one#&lt;/pattern&gt;
    &lt;script&gt;
      switch (object_one) {
        case (troll) {
          msg (&quot;You say: &quot; + text_talk)
          msg (&quot;The troll grunts but otherwise ignores you.&quot;)
        }
        case (bob) {
          msg (&quot;You say: &quot; + text_talk)
          msg (&quot;Bob smiles back at you.&quot;)
        }
        default {
          msg (&quot;You say: &quot; + text_talk + &quot; but the &quot; + object_one.name + &quot; says nothing, possible because, you know, it cannot speak.&quot;)
        }
      }
    &lt;/script&gt;
    &lt;unresolved&gt;Say that to who?&lt;/unresolved&gt;
  &lt;/command&gt;
</code></pre></div>
<p>The pattern you are using is this:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  say #text_talk# to #object_one#
</code></pre></div>
<p>Quest will attempt to match #object_one# to an object present, and if it does then an object variable called &quot;object_one&quot; will be set to that object (if it cannot, Quest will output whatever you typed in the &quot;Unresolved object text&quot; box). The text part will match any text at all, just as before.</p>

<p>Suppose the player types:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  say hi to troll
</code></pre></div>
<p>Quest matches &quot;say&quot; and &quot;to&quot; directly. It then matches &quot;hi&quot; to the text, so now the string variable &quot;text_talk&quot; is set to &quot;hi&quot;. Then it matches the object, as long as the troll is here, and sets the object variable &quot;object_one&quot; to the troll.</p>

<p>The script uses a switch command so you get a different response for different characters, and a default too.</p>

<p>You can set up commands with multiple objects just by giving them each their own name between the # marks.</p>

    </div>
  </body>
</html>
